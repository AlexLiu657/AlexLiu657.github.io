<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>hahah</title>
      <link href="//2022052495b172e3.html"/>
      <url>//2022052495b172e3.html</url>
      
        <content type="html"><![CDATA[<p>在<a href="/202205171260b55f.html">上一篇文章</a>中，用了很大的篇幅介绍了MyBatis的配置，并且再最后进行了简单的CRUD操作，这篇文章按照点的方式来介绍一下MyBatis那些有别于JDBC的用法。</p><div class="story post-story"><h2 id="一、Mapper代理模式"><a href="#一、Mapper代理模式" class="headerlink" title="一、Mapper代理模式"></a>一、Mapper代理模式</h2><p>在基础的应用中使用SqlSession传值statementId(Mapper文件的namespace+对应映射语句的id)实现对数据库的访问，其中的statementId硬编码在代码中，在开发的过程中我们随时随地需要关注这些硬编码的地方，使用Mapper代理的方式可以是我们的开发的注意点放在书写SQL和接口的编写上，接口实现对象由mybatis自动生成代理对象。<br>具体实现还需要满足MyBatis的约定：</p><ul><li>mapper.xml映射文件中namespace指定为mapper接口的全限定名，此步骤目的：通过mapper.xml和mapper.java进行关联</li><li>mapper.xml中statement的id就是mapper.java中方法名</li><li>mapper.xml中statement的parameterType和mapper.java中方法输入参数类型一致</li><li>mapper.xml中statement的resultType和mapper.java中方法返回值类型一致<br>具体代码如下：</li></ul><figure class="highlight java"><figcaption><span>（1）创建一个Mapper接口 UserMapper.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alex.mapper;</span><br><span class="line"><span class="keyword">import</span> com.alex.pojo.User;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserMapper</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt;  <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><figcaption><span>（2）修改（新建）mapper.xml，注意修改namespace</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.alex.mapper.IUserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用户信息ResultMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据用户编号，查询单个用户实体 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">          SELECT * FROM user WHERE id = #&#123;id,javaType=int,jdbcType=NUMERIC&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>（3）通过getMapper方法获取Mapper接口代理对象，使用接口中的方法进行数据库访问</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略上面获取sqlSession的代码，可以查看上一篇的代码</span></span><br><span class="line"><span class="type">IUserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(IUserMapper.class);</span><br><span class="line">List&lt;User&gt; list = userMapper.findAll();</span><br><span class="line"><span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.findUserById(<span class="number">1</span>);</span><br><span class="line">System.out.println(user);</span><br><span class="line">System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.findUserById(<span class="number">1</span>);</span><br><span class="line">System.out.println(user);</span><br></pre></td></tr></table></figure><div class="note warning"><p>上面的Mapper对象是MyBatis生产出的代理对象,具体可以看下图</p></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='proxy'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/25/628e30b0652c9.png' data-fancybox='proxy' data-caption='代理对象'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/25/628e30b0652c9.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/25/628e30b0652c9.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="代理对象"></a><span class='image-caption'>代理对象</span></div></div><div class="note warning"><p>在上面的配置中一定要遵守上面的四条约定，特别要注意的是namespace不可以使用别名</p></div><div class="note info"><p>在实际的使用中一般都会使用Mapper代理模式，后续所有的介绍都将基于这种开发模式进行</p></div></div><div class="story post-story"><h2 id="二、如何传入多个参数"><a href="#二、如何传入多个参数" class="headerlink" title="二、如何传入多个参数"></a>二、如何传入多个参数</h2><p>在上面findUserById方法中，传入了一个Integer类型的id进行查询，实际使用中可能会传入多个参数，MyBatis主要提供了以下四种方式实现</p><h3 id="1、使用map接口传入参数"><a href="#1、使用map接口传入参数" class="headerlink" title="1、使用map接口传入参数"></a>1、使用map接口传入参数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByMap</span><span class="params">(Map&lt;String, Object&gt; parameterMap)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;map&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from user where username =#&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>map适用几乎所有场景，但是map是一个键值对应的集合，使用者要通过阅读它的键，才能明了其作用；其次，使用map不能限定其传递的数据类型，因此业务性质不强，可读性差，使用者要读懂代码才能知道需要传递什么参数给它。</p><h3 id="2、使用注解参数传入参数"><a href="#2、使用注解参数传入参数" class="headerlink" title="2、使用注解参数传入参数"></a>2、使用注解参数传入参数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByAnnotation</span><span class="params">(<span class="meta">@Param(&quot;userName&quot;)</span> String username, <span class="meta">@Param(&quot;password&quot;)</span> String password)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByAnnotation&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from user where username =#&#123;userName&#125; and password = #&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>MyBatis提供了一个注解@Param<code>org.apache.ibatis.annotations.Param</code>，可以通过它去定义映射器的参数名称，使用它可以得到更好的可读性,此时并不需要给出parameterType属性，但是这会带来一个麻烦。如果SQL很复杂，拥有大于10个参数，那么接口方法的参数个数就多了，使用起来就很不容易，这个时候就需要实体类、Java Bean的方法进行传递了。</p><h3 id="3、使用Java-Bean传入参数"><a href="#3、使用Java-Bean传入参数" class="headerlink" title="3、使用Java Bean传入参数"></a>3、使用Java Bean传入参数</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByBean</span><span class="params">(User userParam)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByBean&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from user where username =#&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4、混合使用"><a href="#4、混合使用" class="headerlink" title="4、混合使用"></a>4、混合使用</h3><p>@Param注解后面除了基础数据类型和Java内置类型以外，还可以传入自定义的实体类、Java Bean。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findByMix</span><span class="params">(<span class="meta">@Param(&quot;params&quot;)</span> User userParam)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findByMix&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from user where username =#&#123;params.username&#125; and password = #&#123;params.password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以上是四种传参的方式，可以根据实际情况进行选取。</p></div><div class="story post-story"><h2 id="三、如何记录SQL查询日志"><a href="#三、如何记录SQL查询日志" class="headerlink" title="三、如何记录SQL查询日志"></a>三、如何记录SQL查询日志</h2><p>目前的配置下，MyBatis执行SQL时不会将运行日志输出在控制台或者写在日志中，在后续的使用中需要看一下SQL查询的过程，所以我们需要通过配置使用MyBatis日志功能。<br>在讲MyBatis的主配置文件中，有一个<a href="/202205171260b55f.html#2-settings%EF%BC%88%E8%AE%BE%E7%BD%AE%EF%BC%89">settings属性</a>设置有一个配置项logImpl，这个里面可配置的有SLF4J|LOG4J|LOG4J2|JDK_LOGGING|COMMONS_LOGGING|STDOUT_LOGGING|NO_LOGGING，下面介绍两种方式进行日志的输出。</p><h3 id="1、STDOUT-LOGGING"><a href="#1、STDOUT-LOGGING" class="headerlink" title="1、STDOUT_LOGGING"></a>1、STDOUT_LOGGING</h3><figure class="highlight xml"><figcaption><span>MyBatis主配置文件</span></figcaption><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STDOUT_LOGGING&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/26/628f7f8242699.png' data-fancybox='one' data-caption='运行日志控制台截图1'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/26/628f7f8242699.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/26/628f7f8242699.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="运行日志控制台截图1"></a><span class='image-caption'>运行日志控制台截图1</span></div></div><p>这种方式不太好的地方, 就是还是作为控制台输出的System.out.println, 无法使用我们的日志配置格式, 也没有刷到日志文件中，Debug调试还可以，但是在生产中建议结合日志框架进行操作。</p><h3 id="2、SLF4J"><a href="#2、SLF4J" class="headerlink" title="2、SLF4J"></a>2、SLF4J</h3><figure class="highlight xml"><figcaption><span>(1)pom.xml引入slf4j的jar包</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><figcaption><span>(2)修改MyBatis主配置文件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SLF4J&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><figcaption><span>(3)在项目中创建log4j.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#将等级为DEBUG的日志信息输出到console和file这两个目的地，console和file的定义在下面的代码</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG,console,file</span></span><br><span class="line"><span class="comment">#控制台输出的相关设置</span></span><br><span class="line"><span class="attr">log4j.appender.console</span> = <span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.console.Target</span> = <span class="string">System.out</span></span><br><span class="line"><span class="attr">log4j.appender.console.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.appender.console.layout</span> = <span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.console.layout.ConversionPattern</span>=<span class="string">[%c]-%m%n</span></span><br><span class="line"><span class="comment">#文件输出的相关设置</span></span><br><span class="line"><span class="attr">log4j.appender.file</span> = <span class="string">org.apache.log4j.RollingFileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.file.File</span>=<span class="string">./log/alex.log</span></span><br><span class="line"><span class="attr">log4j.appender.file.MaxFileSize</span>=<span class="string">10mb</span></span><br><span class="line"><span class="attr">log4j.appender.file.Threshold</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">[%p][%d&#123;yy-MM-dd&#125;][%c]%m%n</span></span><br><span class="line"><span class="comment">#日志输出级别</span></span><br><span class="line"><span class="attr">log4j.logger.org.mybatis</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sql</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sql.Statement</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sql.ResultSet</span>=<span class="string">DEBUG</span></span><br><span class="line"><span class="attr">log4j.logger.java.sq1.PreparedStatement</span>=<span class="string">DEBUG</span></span><br></pre></td></tr></table></figure><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/26/628f87da0045c.png' data-fancybox='one' data-caption='运行日志控制台截图2'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/26/628f87da0045c.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/26/628f87da0045c.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="运行日志控制台截图2"></a><span class='image-caption'>运行日志控制台截图2</span></div></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/26/628fa1bc23218.png' data-fancybox='one' data-caption='运行日志文件截图'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/26/628fa1bc23218.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/26/628fa1bc23218.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="运行日志文件截图"></a><span class='image-caption'>运行日志文件截图</span></div></div><p>文章中暂时使用STDOUT_LOGGING进行日志的输出</p></div><div class="story post-story"><h2 id="四、-和-的区别"><a href="#四、-和-的区别" class="headerlink" title="四、#{}和${}的区别"></a>四、#{}和${}的区别</h2><p>在上面的例子中使用#{}代替参数，其实还可以是使用${}来代替参数。<br>#{} 是预编译处理。${} 就是字符串替换。直接替换掉占位符。$方式一般用于传入数据库对象，例如传入表名。使用 ${} 的话会导致 sql 注入。什么是 SQL 注入呢？比如 select * from user where id &#x3D; ${id}<br>这里的id应该是一个数值。然后如果对方传过来的是 001  and name &#x3D; tom。就相当于多加了一个条件。或者把SQL语句直接写进来了，001;drop table user，就直接把表给删了！！！所以为了防止 SQL 注入，能用 #{} 的不要去用${}</p><u>如果非要用 ${} 的话，那要注意防止 SQL 注入问题，可以手动判定传入的变量，进行过滤，一般 SQL 注入会输入很长的一条 SQL 语句</u><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/26/628f8f8d7175f.png' data-fancybox='one' data-caption='${}运行的日志'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/26/628f8f8d7175f.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/26/628f8f8d7175f.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="${}运行的日志"></a><span class='image-caption'>${}运行的日志</span></div></div><p class='p center small'>${}运行的日志</p><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/26/628f8fd52bc0d.png' data-fancybox='one' data-caption='#{}运行的日志'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/26/628f8fd52bc0d.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/26/628f8fd52bc0d.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="#{}运行的日志"></a><span class='image-caption'>#{}运行的日志</span></div></div><p class='p center small'>#{}运行的日志</p><div class="note danger"><p>这里使用的findUserById按照之前的写法改成${}会报错<code>org.apache.ibatis.reflection.ReflectionException: There is no getter for property named id in class java.lang.Integer</code>,因为MyBatis在解析的时候把parameterType&#x3D;int解析成包装类<code>java.lang.Integer</code>，在Integer中不存在id属性，可以使用上面的@Param注解,如下</p></div><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="五、如何在SQL中写一个like"><a href="#五、如何在SQL中写一个like" class="headerlink" title="五、如何在SQL中写一个like"></a>五、如何在SQL中写一个like</h2><p>日常使用中常常会使用like来做模糊查询，在普通的JDBC中通常使用拼接的方式来传递参数，MyBatis下有五种方式来进行like的拼接。<br>首先我们先在Mapper对应的Java中定义一个方法</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByLike</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username)</span>;</span><br></pre></td></tr></table></figure><h3 id="1、使用-进行拼接"><a href="#1、使用-进行拼接" class="headerlink" title="1、使用${}进行拼接"></a>1、使用${}进行拼接</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByLike&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE &#x27;%$&#123;username&#125;%&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这种方式简单，但是无法防止SQL注入，所以不推荐使用</p><h3 id="2、使用-进行拼接"><a href="#2、使用-进行拼接" class="headerlink" title="2、使用#{}进行拼接"></a>2、使用#{}进行拼接</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByLike&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE &quot;%&quot;#&#123;username&#125;&quot;%&quot;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3、使用CONCAT进行字符串拼接"><a href="#3、使用CONCAT进行字符串拼接" class="headerlink" title="3、使用CONCAT进行字符串拼接"></a>3、使用CONCAT进行字符串拼接</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByLike&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE CONCAT(&#x27;%&#x27;,#&#123;username&#125;,&#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="4、使用bind标签"><a href="#4、使用bind标签" class="headerlink" title="4、使用bind标签"></a>4、使用bind标签</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByLike&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27; + username + &#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE #&#123;pattern1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里使用的bind标签是后面要将的动态SQL的一员，主要的作用可以在OGNL表达式中创建一个变量并将其绑定到上下文，换句话说建立新的映射关系，对变量进行操作（比如拼接，拼接可以替换CONCAT）</p><h3 id="5、在调用传值时处理进行拼接"><a href="#5、在调用传值时处理进行拼接" class="headerlink" title="5、在调用传值时处理进行拼接"></a>5、在调用传值时处理进行拼接</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByLike&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE #&#123;username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><figcaption><span>调用时传值</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; list = userMapper.findUserByLike(<span class="string">&quot;%al%&quot;</span>);</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="六、动态SQL"><a href="#六、动态SQL" class="headerlink" title="六、动态SQL"></a>六、动态SQL</h2><p>在实际开发过程中，在需要条件动态拼接的时候会非常痛苦，有时候为了保证SQL的正确性，需要拼接where 1&#x3D;1进行填充；有时候面对动态的参数时还可能会存在SQL注入的问题。MyBatis提供了一些标签实现动态SQL来解决这些问题。</p><h3 id="1、if标签"><a href="#1、if标签" class="headerlink" title="1、if标签"></a>1、if标签</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByIf</span><span class="params">(<span class="meta">@Param(&quot;user&quot;)</span> User user)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByIf&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user WHERE 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.username==&#x27;alex&#x27; and user.username!=null&quot;</span>&gt;</span></span><br><span class="line">        and username LIKE #&#123;user.username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.id <span class="symbol">&amp;lt;</span>= 1&quot;</span>&gt;</span></span><br><span class="line">        and id = #&#123;user.id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>从上面的可以看到，<if test="">中写了对传入参数的判断，比如当user传的是<code>null</code>的话，sql将不会拼接在执行的SQL中，当user对象当中username传的不为<code>null</code>和并且为alex的时候才会拼第一段，当id传入的数字小于等于1的时候才会拼接第二段<br>在上面的例子中有两个注意的点<br>（1）在普通的程序中逻辑表达式是&amp;和|，在if中使用and和or进行代替<br>（2）在 XML 中仅有字符 “&lt;”和”&amp;” 是非法的，需要把他们变成转义字符进行使用</p><table><thead><tr><th>符号</th><th>原符号</th><th>替换符号</th></tr></thead><tbody><tr><td>小于</td><td>&lt;</td><td><code>&amp;lt;</code></td></tr><tr><td>小于等于</td><td>&lt;&#x3D;</td><td><code>&amp;lt;=</code></td></tr><tr><td>大于</td><td>&gt;</td><td><code>&amp;gt;</code></td></tr><tr><td>大于等于</td><td>&gt;&#x3D;</td><td><code>&amp;gt;=</code></td></tr><tr><td>不等于</td><td>&lt;&gt;</td><td><code>&amp;lt;&amp;gt;</code></td></tr><tr><td>与</td><td>&amp;</td><td><code>&amp;amp;</code></td></tr><tr><td>单引号</td><td>‘</td><td><code>&amp;apos;</code></td></tr><tr><td>双引号</td><td>“</td><td><code>&amp;quot;</code></td></tr></tbody></table><p>除了转移字符的形式，还可以使用CDATA区段进行操作</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">大于等于 &lt;![CDATA[ &gt;= ]]&gt;</span><br><span class="line">小于等于 &lt;![CDATA[ &lt;= ]]&gt;</span><br><span class="line">不等于&lt;![CDATA[ &lt;&gt; ]]&gt;</span><br></pre></td></tr></table></figure><h3 id="2、choose-when-otherwise标签"><a href="#2、choose-when-otherwise标签" class="headerlink" title="2、choose, when, otherwise标签"></a>2、choose, when, otherwise标签</h3><p>在JAVA程序中，处理使用if做判断，还会使用switch做判断，比如在判断枚举的时候，会根据不通的类型来拼接SQL，这个时候可以使用choose标签</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByChoose</span><span class="params">(<span class="meta">@Param(&quot;user&quot;)</span> User user)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByChoose&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">     SELECT * FROM user where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.id == 1&quot;</span>&gt;</span></span><br><span class="line">            AND id = 6</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.id == 2 &quot;</span>&gt;</span></span><br><span class="line">            AND id = 5</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            AND id = 7</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>上面例子意思是在传入的user对象id为1的时候拼接第一段SQL，如果id为2时候拼接第二段SQL，如果都不满足则拼接第三段SQL，例子可能没有特殊的含义，理解意思即可，用法类似switch。</p><h3 id="3、where-trim-set标签"><a href="#3、where-trim-set标签" class="headerlink" title="3、where,trim, set标签"></a>3、where,trim, set标签</h3><p>在上面的例子中还是存在where 1&#x3D;1的拼接，这个时候就需要结合where标签进行动态的拼接</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByIf&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.username==&#x27;alex&#x27; and user.username!=null&quot;</span>&gt;</span></span><br><span class="line">        and username LIKE #&#123;user.username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.id <span class="symbol">&amp;lt;</span>= 1&quot;</span>&gt;</span></span><br><span class="line">        and id = #&#123;user.id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这个标签里面会自动拼接上where 并且把第一个and或者or去掉<br>除了上面的where标签，还可以MyBatis提供的trim标签，代码如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByIf&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;WHERE&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;AND|OR&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.username==&#x27;alex&#x27; and user.username!=null&quot;</span>&gt;</span></span><br><span class="line">         username LIKE #&#123;user.username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user!=null and user.id <span class="symbol">&amp;lt;</span>= 1&quot;</span>&gt;</span></span><br><span class="line">        or id = #&#123;user.id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>介绍完了where的情况，在修改的时候会使用set语言，这个时候set的值也需要自动拼接，在最后一个的字段的时候需要把拼接的逗号去掉，这个时候可以使用set标签，代码如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserByIf&quot;</span>&gt;</span></span><br><span class="line">  update user</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.username != null&quot;</span>&gt;</span>username=#&#123;user.username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.password != null&quot;</span>&gt;</span>password=#&#123;user.password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.birthday != null&quot;</span>&gt;</span>birthday=#&#123;user.birthday&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>同where标签相同，set标签会自动添加set以及去掉最后的逗号<br>同样的，set标签也可以使用trim标签代替，代码如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserByIf&quot;</span>&gt;</span></span><br><span class="line">  update user</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span>  <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.username != null&quot;</span>&gt;</span>username=#&#123;user.username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.password != null&quot;</span>&gt;</span>password=#&#123;user.password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;user.birthday != null&quot;</span>&gt;</span>birthday=#&#123;user.birthday&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">  where id=#&#123;user.id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure><p>讲了这么多的trim标签，发现他里面有四个主要的属性：</p><ul><li>prefix :在trim中包含的语句前加上前缀内容</li><li>suffix :在trim中包含的语句后加上后缀内容</li><li>prefixOverrides:去除对应的前缀</li><li>suffixOverrides :去除对应的后缀<div class="note info"><p>trim标签在insert中可以使用prefix，suffix，suffixOverrides的结合去掉最后的，并在前后拼接括号。</p></div></li></ul><h3 id="4、foreach标签"><a href="#4、foreach标签" class="headerlink" title="4、foreach标签"></a>4、foreach标签</h3><p>有时候参数会传入一个集合或数组进行遍历，通常这种情况发生在IN的拼接和insert的拼接中</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByForeach</span><span class="params">(<span class="meta">@Param(&quot;usernameList&quot;)</span>List usernameList)</span>;</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByForeach&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;usernameList&quot;</span> <span class="attr">open</span>=<span class="string">&quot;username IN (&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;username&quot;</span> <span class="attr">index</span>=<span class="string">&quot;i&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                #&#123;username&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/30/6294d5ed535ba.png' data-fancybox='one' data-caption='in解析的SQL'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/30/6294d5ed535ba.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/30/6294d5ed535ba.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="in解析的SQL"></a><span class='image-caption'>in解析的SQL</span></div></div><p>foreach主要的属性有下面几个</p><ul><li>collection：入参类型，可以是list、array</li><li>open：前缀</li><li>close：后缀</li><li>separator： 循环的部分以此分割</li><li>item：集合（数组）子元素的别名。子元素也可以是对象</li><li>index：当前子元素的下标。</li></ul><h3 id="5、bind标签"><a href="#5、bind标签" class="headerlink" title="5、bind标签"></a>5、bind标签</h3><p>bind标签在上面的like拼接中使用过，作用是将对应传过来的参数进行拼接成新的参数进行使用。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByLike&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;pattern1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27; + username + &#x27;%&#x27;&quot;</span> /&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE username LIKE #&#123;pattern1&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6、sql标签"><a href="#6、sql标签" class="headerlink" title="6、sql标签"></a>6、sql标签</h3><p>在上面的所有SQL语句中，我们都有一句共同的SELECT * FROM user，当然正式使用肯定不能用*，一般都会使用字段名，但是字段名多的话会有很多的重复性，这个时候就可以把公共的SQL提出到SQL标签中，后面在使用的地方进行引用。</p><figure class="highlight xml"><figcaption><span>定义SQL标签</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectSql&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><figcaption><span>使用include标签进行引用</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span>  <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectSql&quot;</span> /&gt;</span> WHERE id = $&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note info"><p>sql标签也支持多数据库厂商操作，可以使用databaseId进行配置。</p></div></div><div class="story post-story"><h2 id="七、如何获得数据库的自增主键"><a href="#七、如何获得数据库的自增主键" class="headerlink" title="七、如何获得数据库的自增主键"></a>七、如何获得数据库的自增主键</h2><h2 id="八、如何完成分页查询"><a href="#八、如何完成分页查询" class="headerlink" title="八、如何完成分页查询"></a>八、如何完成分页查询</h2><h2 id="九、如何实现一对多的查询"><a href="#九、如何实现一对多的查询" class="headerlink" title="九、如何实现一对多的查询"></a>九、如何实现一对多的查询</h2><h2 id="十、缓存机制"><a href="#十、缓存机制" class="headerlink" title="十、缓存机制"></a>十、缓存机制</h2><h2 id="十一、Spring整合"><a href="#十一、Spring整合" class="headerlink" title="十一、Spring整合"></a>十一、Spring整合</h2><h2 id="十二、Mybatis代码生成"><a href="#十二、Mybatis代码生成" class="headerlink" title="十二、Mybatis代码生成"></a>十二、Mybatis代码生成</h2></div>]]></content>
      
      
      <categories>
          
          <category> 分类6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 测试11 </tag>
            
            <tag> 测试10 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>12312312312qdasfafafasfaef</title>
      <link href="//202205171260b55f.html"/>
      <url>//202205171260b55f.html</url>
      
        <content type="html"><![CDATA[<p>MyBatis作为一个优秀的持久层框架，目前在我的大多数日常学习和工作中被用来当作数据库Java访问数据库的一种方式，就像《塞尔达传说：旷野之息》之于NS的护航大作一样，我开篇博文准备写一下我所知的MyBatis，做一次学习笔记。😄</p><div class="story post-story"><h2 id="一、MyBatis初体验"><a href="#一、MyBatis初体验" class="headerlink" title="一、MyBatis初体验"></a>一、MyBatis初体验</h2><h3 id="1-创建测试数据库"><a href="#1-创建测试数据库" class="headerlink" title="1.创建测试数据库"></a>1.创建测试数据库</h3><p>下面是文章中的使用到的建表语句，本文采用的数据库是Mysql 8.0.27</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `<span class="keyword">user</span>` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `birthday` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">3</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;alex&#x27;</span>, <span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;2019-12-12&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `<span class="keyword">user</span>` <span class="keyword">VALUES</span> (<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;it65720&#x27;</span>,<span class="string">&#x27;123&#x27;</span>, <span class="string">&#x27;2019-12-12&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="2-导入依赖"><a href="#2-导入依赖" class="headerlink" title="2.导入依赖"></a>2.导入依赖</h3><p>本文使用Maven进行构建</p><div class="tabs" id="tab-dependency"><ul class="nav-tabs"><li class="tab active"><a class="#dependency-1">Maven</a></li><li class="tab"><a class="#dependency-2">jar包</a></li></ul><div class="tab-content"><div class="tab-pane active" id="dependency-1"><figure class="highlight xml"><figcaption><span>pom.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--mysql驱动--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="dependency-2"><p>MyBatis的jar包下载：<a href="https://github.com/mybatis/mybatis-3/releases">https://github.com/mybatis/mybatis-3/releases</a><br>MySQL数据库驱动下载：<a href="https://dev.mysql.com/downloads/connector/j/">https://dev.mysql.com/downloads/connector/j/</a></p></div></div></div><h3 id="3-创建表对应的实体类"><a href="#3-创建表对应的实体类" class="headerlink" title="3.创建表对应的实体类"></a>3.创建表对应的实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.alex.pojo;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String birthday;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getBirthday</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBirthday</span><span class="params">(String birthday)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, username=&#x27;&quot;</span> + username + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, password=&#x27;&quot;</span> + password + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, birthday=&#x27;&quot;</span> + birthday + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-创建mybatis-config-xml主配置文件和数据库配置文件"><a href="#4-创建mybatis-config-xml主配置文件和数据库配置文件" class="headerlink" title="4.创建mybatis-config.xml主配置文件和数据库配置文件"></a>4.创建mybatis-config.xml主配置文件和数据库配置文件</h3><figure class="highlight xml"><figcaption><span>mybatis-config.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入外部资源文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据源环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据库事务管理类型 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据源，type=pooled 说明是使用连接池方式，可以节省资源 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 调用资源文件里的用户信息--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载映射文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;UserMapper.xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><figcaption><span>jdbc.properties</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://192.168.56.103:3306/mybatis?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br></pre></td></tr></table></figure><h3 id="5-创建XML映射文件"><a href="#5-创建XML映射文件" class="headerlink" title="5.创建XML映射文件"></a>5.创建XML映射文件</h3><figure class="highlight xml"><figcaption><span>UserMapper.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--查询用户--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-编写main方法进行测试"><a href="#6-编写main方法进行测试" class="headerlink" title="6.编写main方法进行测试"></a>6.编写main方法进行测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    List&lt;User&gt; list = sqlSession.selectList(<span class="string">&quot;User.findAll&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/12/627be50dd7d8c.png' data-fancybox='one' data-caption='demo目录结构'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/12/627be50dd7d8c.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/12/627be50dd7d8c.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="demo目录结构"></a><span class='image-caption'>demo目录结构</span></div></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/12/627be50d297a7.png' data-fancybox='one' data-caption='demo运行结果'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/12/627be50d297a7.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/12/627be50d297a7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="demo运行结果"></a><span class='image-caption'>demo运行结果</span></div></div><p>上面的demo运行结束后，MyBatis将返回的结果集自动转换成对应的实体类，我理解的这个就是ORM（对象关系映射），但是上面的操作只是一个进行简单的MyBatis的配置的小例子，距离<br>真正的实践还差很多，下面先来分析重要的配置文件之一，在测试代码段里面加载的文件mybatis-config.xml。</p></div><div class="story post-story"><h2 id="二、MyBatis的主配置文件"><a href="#二、MyBatis的主配置文件" class="headerlink" title="二、MyBatis的主配置文件"></a>二、MyBatis的主配置文件</h2><p>MyBatis的配置文件包含了会影响 MyBatis 行为的设置和属性信息。 配置文档的顶层结构如下：</p><ul><li>properties</li><li>settings</li><li>typeAliases</li><li>typeHandlers</li><li>objectFactory</li><li>plugins</li><li>environments<ul><li>environment<ul><li>transactionManager</li><li>dataSource</li></ul></li></ul></li><li>databaseIdProvider</li><li>mappers</li></ul><div class="note warning"><p>MyBatis中的配置，不但有类型限制，还有顺序限制，必须按照上面树状结构的顺序进行配置。</p></div><h3 id="1-properties（属性）"><a href="#1-properties（属性）" class="headerlink" title="1.properties（属性）"></a>1.properties（属性）</h3><p>标签中的数据可以在配置文件其他地方进行使用，使用${}可以获取对应的值，有两种配置的方式第一种就是在上面使用外部properties文件进行提供数据，第二种就是在properties中添加property子标签进行配置。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入外部资源文件--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;properties resource=&quot;jdbc.properties&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- property里面的属性全局均可使用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://192.168.56.103:3306/mybatis&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbc.password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-settings（设置）"><a href="#2-settings（设置）" class="headerlink" title="2.settings（设置）"></a>2.settings（设置）</h3><p>settings配置影响MyBatiis框架在运行时的一些行为。settings配置缓存、延迟加载、结果集控制、执行器、分页设置、命名规则等一系列控制性参数。所有的setting配置都被包裹在settings标签对中。</p><table><thead><tr><th>设置名</th><th align="left">描述</th><th>有效值</th><th>默认值</th></tr></thead><tbody><tr><td>cacheEnabled</td><td align="left">全局性地开启或关闭所有映<br />射器配置文件中已配置的任何缓存。</td><td>true&#x2F;false</td><td>true</td></tr><tr><td>lazyLoadingEnabled</td><td align="left">延迟加载的全局开关。当开启时，所有关联对象<br />都会延迟加载。特定关联关系中可通过<br />设置 <code>fetchType</code> 属性来覆盖该项的开关状态。</td><td>true&#x2F;false</td><td>false</td></tr><tr><td>aggressiveLazyLoading</td><td align="left">开启时，任一方法的调用都会加载该对象的所有延迟加载属性。<br /> 否则，每个延迟加载属性会按需加载<br />（参考 <code>lazyLoadTriggerMethods</code>)。</td><td>true&#x2F;false</td><td>false</td></tr><tr><td>multipleResultSetsEnabled</td><td align="left">是否允许单个语句返回多结果集<br />（需要数据库驱动支持）。</td><td>true&#x2F;false</td><td>true</td></tr><tr><td>useColumnLabel</td><td align="left">使用列标签代替列名。<br />实际表现依赖于数据库驱动，<br />具体可参考数据库驱动的相关文档，<br />或通过对比测试来观察。</td><td>true&#x2F;false</td><td>true</td></tr><tr><td>useGeneratedKeys</td><td align="left">允许 JDBC 支持自动生成主键，需要数据库驱动支持。<br />如果设置为 true，将强制使用自动生成主键。<br />尽管一些数据库驱动不支持此特性，但仍可正常工作（如 Derby）</td><td>true&#x2F;false</td><td>False</td></tr><tr><td>autoMappingBehavior</td><td align="left">指定 MyBatis 应如何自动映射列到字段或属性。<br /> NONE 表示关闭自动映射；<br />PARTIAL 只会自动映射没有定义嵌套结果映射的字段。 <br />FULL 会自动映射任何复杂的结果集（无论是否嵌套）。</td><td>NONE<br />PARTIAL<br />FULL</td><td>PARTIAL</td></tr><tr><td>autoMapping<br />UnknownColumn<br />Behavior</td><td align="left">指定发现自动映射目标未知列（或未知属性类型）的行为。<br /><code>NONE</code>: 不做任何反应<code>WARNING</code>: 输出警告日志<br />（’org.apache.ibatis.session.<br />AutoMappingUnknownColumnBehavior’ 的日志等级必须设置为 <code>WARN</code>）<code>FAILING</code>: <br />映射失败 (抛出 <code>SqlSessionException</code>)</td><td>NONE<br />WARNING<br />FAILING</td><td>NONE</td></tr><tr><td>defaultExecutorType</td><td align="left">配置默认的执行器。SIMPLE 就是普通的执行器；<br />REUSE 执行器会重用预处理语句（PreparedStatement）；<br /> BATCH 执行器不仅重用语句还会执行批量更新。</td><td>SIMPLE<br />REUSE<br />BATCH</td><td>SIMPLE</td></tr><tr><td>defaultStatementTimeout</td><td align="left">设置超时时间，它决定数据库驱动等待数据库响应的秒数。</td><td>任意正整数</td><td>未设置 (null)</td></tr><tr><td>defaultFetchSize</td><td align="left">为驱动的结果集获取数量（fetchSize）设置一个建议值。<br />此参数只可以在查询设置中被覆盖。</td><td>任意正整数</td><td>未设置 (null)</td></tr><tr><td>defaultResultSetType</td><td align="left">指定语句默认的滚动策略。（新增于 3.5.2）</td><td>FORWARD_ONLY<br />SCROLL_SENSITIVE<br />SCROLL_INSENSITIVE<br />DEFAULT（等同于未设置）</td><td>未设置 (null)</td></tr><tr><td>safeRowBoundsEnabled</td><td align="left">是否允许在嵌套语句中使用分页（RowBounds）。<br />如果允许使用则设置为 false。</td><td>true&#x2F;false</td><td>False</td></tr><tr><td>safeResultHandlerEnabled</td><td align="left">是否允许在嵌套语句中使用结果处理器（ResultHandler）。<br />如果允许使用则设置为 false。</td><td>true&#x2F;false</td><td>True</td></tr><tr><td>mapUnderscoreToCamelCase</td><td align="left">是否开启驼峰命名自动映射，<br />即从经典数据库列名 A_COLUMN 映射<br />到经典 Java 属性名 aColumn。</td><td>true&#x2F;false</td><td>False</td></tr><tr><td>localCacheScope</td><td align="left">MyBatis 利用本地缓存机制（Local Cache）<br />防止循环引用和加速重复的嵌套查询。 <br />默认值为 SESSION，会缓存一个会话<br />中执行的所有查询。<br /> 若设置值为 STATEMENT，<br />本地缓存将仅用于执行语句，<br />对相同 SqlSession 的不同查询将不会<br />进行缓存。</td><td>SESSION<br />STATEMENT</td><td>SESSION</td></tr><tr><td>jdbcTypeForNull</td><td align="left">当没有为参数指定特定的 JDBC 类型时，<br />空值的默认 JDBC 类型。 <br />某些数据库驱动需要指定列的 JDBC 类型，<br />多数情况直接用一般类型即可，<br />比如 NULL、VARCHAR 或 OTHER。</td><td>JdbcType 常量，常用值：NULL、VARCHAR 或 OTHER。</td><td>OTHER</td></tr><tr><td>lazyLoadTriggerMethods</td><td align="left">指定对象的哪些方法触发一次延迟加载。</td><td>用逗号分隔的方法列表。</td><td>equals<br />,clone,<br />hashCode<br />,toString</td></tr><tr><td>defaultScriptingLanguage</td><td align="left">指定动态 SQL 生成使用的默认脚本语言。</td><td>一个类型别名或全限定类名。</td><td>org.<br />apache.i<br />batis.<br />scripting.<br />xmltags.<br />XMLLanguageDriver</td></tr><tr><td>defaultEnumTypeHandler</td><td align="left">指定 Enum 使用的默认 <code>TypeHandler</code> 。（新增于 3.4.5）</td><td>一个类型别名或全限定类名。</td><td>org.<br />apache.<br />ibatis.<br />type.<br />EnumTypeHandler</td></tr><tr><td>callSettersOnNulls</td><td align="left">指定当结果集中值为 null 的时候<br />是否调用映射对象的 setter（map 对象时为 put）方法<br />，这在依赖于 Map.keySet() 或 null 值进行初始化时比较有用。<br />注意基本类型（int、boolean 等）是不能设置成 null 的。</td><td>true&#x2F;false</td><td>false</td></tr><tr><td>returnInstance<br />ForEmptyRow</td><td align="left">当返回行的所有列都是空时，<br />MyBatis默认返回 <code>null</code>。<br /> 当开启这个设置时，MyBatis会返回一个空实例。<br /> 请注意，它也适用于嵌套的结果集（如集合或关联）。<br />（新增于 3.4.2）</td><td>true&#x2F;false</td><td>false</td></tr><tr><td>logPrefix</td><td align="left">指定 MyBatis 增加到日志名称的前缀。</td><td>任何字符串</td><td>未设置</td></tr><tr><td>logImpl</td><td align="left">指定 MyBatis 所用日志的具体实现，<br />未指定时将自动查找。</td><td>SLF4J<br />LOG4J(deprecated since 3.5.9)<br />LOG4J2&#x2F;<br />DK_LOGGING<br />COMMONS_LOGGING <br />STDOUT_LOGGING<br />NO_LOGGING</td><td>未设置</td></tr><tr><td>proxyFactory</td><td align="left">指定 Mybatis 创建可延迟加载对象所用到的代理工具。</td><td>CGLIB&#x2F; JAVASSIST</td><td>JAVASSIST <br />（MyBatis 3.3 以上）</td></tr><tr><td>vfsImpl</td><td align="left">指定 VFS 的实现</td><td>自定义 VFS 的实现的类<br />全限定名，以逗号分隔。</td><td>未设置</td></tr><tr><td>useActualParamName</td><td align="left">允许使用方法签名中的名称作为语句参数名称。<br />为了使用该特性，你的项目必须采用 Java 8 编译，并且加上 <code>-parameters</code> 选项。（新增于 3.4.1）</td><td>true&#x2F;false</td><td>true</td></tr><tr><td>configurationFactory</td><td align="left">指定一个提供 <code>Configuration</code> 实例的类。<br /> 这个被返回的 Configuration 实例用来加载被<br />反序列化对象的延迟加载属性值。 <br />这个类必须包含一个<br />签名为<code>static Configuration getConfiguration()</code> 的方法。<br />（新增于 3.2.3）</td><td>一个类型别名或完全限定类名。</td><td>未设置</td></tr></tbody></table><p>settings 的配置项很多，但是真正用到的不会太多，很多都保持了默认，把常用的配置项研究清楚就可以了，比如关于缓存的 cacheEnabled，关于级联的 lazyLoadingEnabled 和 aggressiveLazy Loading，关于自动映射的 autoMappingBehavior 和 mapUnderscoreToCamelCase，关于执行器类型的 defaultExecutorType 等,本文暂时先讲一下基本的配置，后面想开篇深入研究一下Mybatis的缓存机制和级联的延迟加载。</p><figure class="highlight xml"><figcaption><span>这是一份比较完整的配置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;multipleResultSetsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useColumnLabel&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;useGeneratedKeys&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PARTIAL&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;autoMappingUnknownColumnBehavior&quot;</span> <span class="attr">value</span>=<span class="string">&quot;WARNING&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SIMPLE&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultStatementTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;25&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultFetchSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;safeRowBoundsEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;localCacheScope&quot;</span> <span class="attr">value</span>=<span class="string">&quot;SESSION&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;OTHER&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadTriggerMethods&quot;</span> <span class="attr">value</span>=<span class="string">&quot;equals,clone,hashCode,toString&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-typeAliases（类型别名）"><a href="#3-typeAliases（类型别名）" class="headerlink" title="3.typeAliases（类型别名）"></a>3.typeAliases（类型别名）</h3><p>在上面demo中的的UserMapper.xml中配置的resultType为实体类的全类名，但是在使用过程中可以选择别名的方式代替代码中的全类型<br>别名在XML中的配置主要有以下两种方式</p><div class="tabs" id="tab-typealiases"><ul class="nav-tabs"><li class="tab active"><a class="#typealiases-1">对单个类进行起别名</a></li><li class="tab"><a class="#typealiases-2">对整个包进行起别名</a></li></ul><div class="tab-content"><div class="tab-pane active" id="typealiases-1"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;UsEr&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">typeAlias</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>映射文件中使用，可以忽略大小写<figure class="highlight xml"><figcaption><span>Mapper.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查询用户--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;UsER&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></div><div class="tab-pane" id="typealiases-2"><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.alex.pojo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>映射文件中使用，定义别名的规则就是对应包装类的类名，可以忽略大小写<figure class="highlight xml"><figcaption><span>Mapper.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></div></div></div><p>MyBatis已经为Java的常见类型默认指定了别名，可以直接使用。这里要注意的是，有一些基本数据类型和包装类数据类型的名称一样（除了包装类中首字母大写的类），故在基本数据类型的前面加上下划线“_”作为区分。</p><p><strong>MyBatis中常见类型别名：</strong></p><table><thead><tr><th>别名</th><th>映射的类型</th></tr></thead><tbody><tr><td>_byte</td><td>byte</td></tr><tr><td>_long</td><td>long</td></tr><tr><td>_short</td><td>short</td></tr><tr><td>_int</td><td>int</td></tr><tr><td>_integer</td><td>int</td></tr><tr><td>_double</td><td>double</td></tr><tr><td>_float</td><td>float</td></tr><tr><td>_boolean</td><td>boolean</td></tr><tr><td>string</td><td>String</td></tr><tr><td>byte</td><td>Byte</td></tr><tr><td>long</td><td>Long</td></tr><tr><td>short</td><td>Short</td></tr><tr><td>int</td><td>Integer</td></tr><tr><td>integer</td><td>Integer</td></tr><tr><td>double</td><td>Double</td></tr><tr><td>float</td><td>Float</td></tr><tr><td>boolean</td><td>Boolean</td></tr><tr><td>date</td><td>Date</td></tr><tr><td>decimal</td><td>BigDecimal</td></tr><tr><td>bigdecimal</td><td>BigDecimal</td></tr><tr><td>object</td><td>Object</td></tr><tr><td>map</td><td>Map</td></tr><tr><td>hashmap</td><td>HashMap</td></tr><tr><td>list</td><td>List</td></tr><tr><td>arraylist</td><td>ArrayList</td></tr><tr><td>collection</td><td>Collection</td></tr><tr><td>iterator</td><td>Iterator</td></tr></tbody></table><h3 id="4-typeHandlers（类型处理器）"><a href="#4-typeHandlers（类型处理器）" class="headerlink" title="4.typeHandlers（类型处理器）"></a>4.typeHandlers（类型处理器）</h3><p>在MyBatis的映射配置文件中，在使用SQL往数据库输入数据的时候最终要从Java类型转换成数据库能识别的类型，而SQL从数据库的查询结果集中获取的数据，也要从数据库的数据类型转换为对应的Java类型。在MyBatis中，使用类型处理器（TypeHandler）将从数据库获取的值以合适的方式转换为Java类型，或者将Java类型的参数转换为数据库对应的类型。在MyBatis中已经有许多自带的类型处理器，但有时候也会满足不了开发的需求，这时候就需要配置自己的类型处理器了，typeHandlers标签就是用来声明自己的类型处理器的。</p><p><strong>MyBatis提供默认的类型处理器：</strong></p><table><thead><tr><th>类型处理器</th><th>Java 类型</th><th>JDBC 类型</th></tr></thead><tbody><tr><td><code>BooleanTypeHandler</code></td><td><code>java.lang.Boolean</code>, <code>boolean</code></td><td>数据库兼容的 <code>BOOLEAN</code></td></tr><tr><td><code>ByteTypeHandler</code></td><td><code>java.lang.Byte</code>, <code>byte</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>BYTE</code></td></tr><tr><td><code>ShortTypeHandler</code></td><td><code>java.lang.Short</code>, <code>short</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>SMALLINT</code></td></tr><tr><td><code>IntegerTypeHandler</code></td><td><code>java.lang.Integer</code>, <code>int</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>INTEGER</code></td></tr><tr><td><code>LongTypeHandler</code></td><td><code>java.lang.Long</code>, <code>long</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>BIGINT</code></td></tr><tr><td><code>FloatTypeHandler</code></td><td><code>java.lang.Float</code>, <code>float</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>FLOAT</code></td></tr><tr><td><code>DoubleTypeHandler</code></td><td><code>java.lang.Double</code>, <code>double</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>DOUBLE</code></td></tr><tr><td><code>BigDecimalTypeHandler</code></td><td><code>java.math.BigDecimal</code></td><td>数据库兼容的 <code>NUMERIC</code> 或 <code>DECIMAL</code></td></tr><tr><td><code>StringTypeHandler</code></td><td><code>java.lang.String</code></td><td><code>CHAR</code>, <code>VARCHAR</code></td></tr><tr><td><code>ClobReaderTypeHandler</code></td><td><code>java.io.Reader</code></td><td>-</td></tr><tr><td><code>ClobTypeHandler</code></td><td><code>java.lang.String</code></td><td><code>CLOB</code>, <code>LONGVARCHAR</code></td></tr><tr><td><code>NStringTypeHandler</code></td><td><code>java.lang.String</code></td><td><code>NVARCHAR</code>, <code>NCHAR</code></td></tr><tr><td><code>NClobTypeHandler</code></td><td><code>java.lang.String</code></td><td><code>NCLOB</code></td></tr><tr><td><code>BlobInputStreamTypeHandler</code></td><td><code>java.io.InputStream</code></td><td>-</td></tr><tr><td><code>ByteArrayTypeHandler</code></td><td><code>byte[]</code></td><td>数据库兼容的字节流类型</td></tr><tr><td><code>BlobTypeHandler</code></td><td><code>byte[]</code></td><td><code>BLOB</code>, <code>LONGVARBINARY</code></td></tr><tr><td><code>DateTypeHandler</code></td><td><code>java.util.Date</code></td><td><code>TIMESTAMP</code></td></tr><tr><td><code>DateOnlyTypeHandler</code></td><td><code>java.util.Date</code></td><td><code>DATE</code></td></tr><tr><td><code>TimeOnlyTypeHandler</code></td><td><code>java.util.Date</code></td><td><code>TIME</code></td></tr><tr><td><code>SqlTimestampTypeHandler</code></td><td><code>java.sql.Timestamp</code></td><td><code>TIMESTAMP</code></td></tr><tr><td><code>SqlDateTypeHandler</code></td><td><code>java.sql.Date</code></td><td><code>DATE</code></td></tr><tr><td><code>SqlTimeTypeHandler</code></td><td><code>java.sql.Time</code></td><td><code>TIME</code></td></tr><tr><td><code>ObjectTypeHandler</code></td><td>Any</td><td><code>OTHER</code> 或未指定类型</td></tr><tr><td><code>EnumTypeHandler</code></td><td>Enumeration Type</td><td>VARCHAR 或任何兼容的字符串类型，用来存储枚举的名称（而不是索引序数值）</td></tr><tr><td><code>EnumOrdinalTypeHandler</code></td><td>Enumeration Type</td><td>任何兼容的 <code>NUMERIC</code> 或 <code>DOUBLE</code> 类型，用来存储枚举的序数值（而不是名称）。</td></tr><tr><td><code>SqlxmlTypeHandler</code></td><td><code>java.lang.String</code></td><td><code>SQLXML</code></td></tr><tr><td><code>InstantTypeHandler</code></td><td><code>java.time.Instant</code></td><td><code>TIMESTAMP</code></td></tr><tr><td><code>LocalDateTimeTypeHandler</code></td><td><code>java.time.LocalDateTime</code></td><td><code>TIMESTAMP</code></td></tr><tr><td><code>LocalDateTypeHandler</code></td><td><code>java.time.LocalDate</code></td><td><code>DATE</code></td></tr><tr><td><code>LocalTimeTypeHandler</code></td><td><code>java.time.LocalTime</code></td><td><code>TIME</code></td></tr><tr><td><code>OffsetDateTimeTypeHandler</code></td><td><code>java.time.OffsetDateTime</code></td><td><code>TIMESTAMP</code></td></tr><tr><td><code>OffsetTimeTypeHandler</code></td><td><code>java.time.OffsetTime</code></td><td><code>TIME</code></td></tr><tr><td><code>ZonedDateTimeTypeHandler</code></td><td><code>java.time.ZonedDateTime</code></td><td><code>TIMESTAMP</code></td></tr><tr><td><code>YearTypeHandler</code></td><td><code>java.time.Year</code></td><td><code>INTEGER</code></td></tr><tr><td><code>MonthTypeHandler</code></td><td><code>java.time.Month</code></td><td><code>INTEGER</code></td></tr><tr><td><code>YearMonthTypeHandler</code></td><td><code>java.time.YearMonth</code></td><td><code>VARCHAR</code> 或 <code>LONGVARCHAR</code></td></tr><tr><td><code>JapaneseDateTypeHandler</code></td><td><code>java.time.chrono.JapaneseDate</code></td><td><code>DATE</code></td></tr></tbody></table><h3 id="5、对象工厂（objectFactory）"><a href="#5、对象工厂（objectFactory）" class="headerlink" title="5、对象工厂（objectFactory）"></a>5、对象工厂（objectFactory）</h3><p>每次MyBatis创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成实例化工作。 默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认无参构造方法，要么通过存在的参数映射来调用带有参数的构造方法。 如果想覆盖对象工厂的默认行为，可以通过创建自己的对象工厂来实现。</p><h3 id="6、插件（plugins）"><a href="#6、插件（plugins）" class="headerlink" title="6、插件（plugins）"></a>6、插件（plugins）</h3><p>插件可以在映射语句执行过程中的某一点进行拦截调用，也可以通过重写方法对执行过程进行修改，可以用作日志记录、权限控制、缓存控制等。</p><div class="note warning"><p>MyBatis中的插件一定要慎用，如果使用不当回对返回结果以及执行过程产生影响，有可能会影响MyBatis的核心功能</p></div><h3 id="7、环境配置（environments）"><a href="#7、环境配置（environments）" class="headerlink" title="7、环境配置（environments）"></a>7、环境配置（environments）</h3><p>MyBatis可以配置成适应多种环境，这种机制有助于将 SQL 映射应用于多种数据库之中， 现实情况下有多种理由需要这么做。</p><div class="note warning"><p>这里要注意的是尽管可以配置多个环境，每个 SqlSessionFactory 实例只能选择其一。也就是如果你想连接两个数据库，就需要创建两个 SqlSessionFactory 实例，每个数据库对应一个。而如果是三个数据库，就需要三个实例，可以使用下面两种方法进行实现。</p></div><p>为了指定创建哪种环境，只要将它作为可选的参数传递给 SqlSessionFactoryBuilder即可。</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(reader, environment);</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">factory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(reader, environment,properties);</span><br></pre></td></tr></table></figure><p>把上面的代码拿下来看一下</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;...&quot;</span> <span class="attr">value</span>=<span class="string">&quot;...&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这里可以看到有有四个关键的地方</p><ul><li>default&#x3D;”development”  指定默认的环境</li><li>id&#x3D;”development” 指定环境的id，提供给上面的方法进行构造SqlSessionFactory使用</li><li>transactionManager  事务管理器的配置</li><li>dataSource 数据源的配置</li></ul><p>下面主要讲一下transactionManager 和 dataSource</p><h4 id="7-1、事务管理器（transactionManager）"><a href="#7-1、事务管理器（transactionManager）" class="headerlink" title="7.1、事务管理器（transactionManager）"></a>7.1、事务管理器（transactionManager）</h4><p>在 MyBatis 中有两种类型的事务管理器（也就是 type&#x3D;”[JDBC|MANAGED]”）：</p><ul><li>JDBC – 这个配置就是直接使用了 JDBC 的提交和回滚设置，它依赖于从数据源得到的连接来管理事务范围。</li><li>MANAGED – 这个配置几乎没做什么。它从来不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接，然而一些容器并不希望这样，因此需要将 closeConnection 属性设置为 false 来阻止它默认的关闭行为。比如下面:</li></ul><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;MANAGED&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;closeConnection&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br></pre></td></tr></table></figure><div class="note link green"><p>后期一般会使用Spring + MyBatis，则没有必要配置事务管理器， 因为 Spring 模块会使用自带的管理器来覆盖前面的配置。</p></div><h4 id="7-2、数据源（dataSource）"><a href="#7-2、数据源（dataSource）" class="headerlink" title="7.2、数据源（dataSource）"></a>7.2、数据源（dataSource）</h4><p>dataSource元素使用标准的JDBC数据源接口来配置JDBC连接对象的资源,有三种内建的数据源类型（也就是 type&#x3D;”[UNPOOLED|POOLED|JNDI]”）：<br>（1）UNPOOLED这个数据源的实现只是每次被请求时打开和关闭连接。虽然一点慢，它对在及时可用连接方面没有性能要求的简单应用程序是一个很好的选择。 不同的数据库在这方面表现也是不一样的，所以对某些数据库来说使用连接池并不重要，这个配置也是理想的。UNPOOLED 类型的数据源仅仅需要配置以下 5 种属性：</p><ul><li>driver – 这是 JDBC 驱动的 Java 类的完全限定名（并不是JDBC驱动中可能包含的数据源类）。</li><li>url – 这是数据库的 JDBC URL 地址。</li><li>username – 登录数据库的用户名。</li><li>password – 登录数据库的密码。</li><li>defaultTransactionIsolationLevel – 默认的连接事务隔离级别。<br>作为可选项，你也可以传递属性给数据库驱动。要这样做，属性的前缀为”driver.”，例如：driver.encoding&#x3D;UTF8</li></ul><p>（2）POOLED这种数据源的实现利用”池”的概念将 JDBC 连接对象组织起来，避免了创建新的连接实例时所必需的初始化和认证时间。 这是一种使得并发 Web 应用快速响应请求的流行处理方式。<br>除了上述提到 UNPOOLED 下的属性外，会有更多属性用来配置 POOLED 的数据源：</p><ul><li>poolMaximumActiveConnections – 在任意时间可以存在的活动（也就是正在使用）连接数量，默认值：10</li><li>poolMaximumIdleConnections – 任意时间可能存在的空闲连接数。</li><li>poolMaximumCheckoutTime – 在被强制返回之前，池中连接被检出（checked out）时间，默认值：20000 毫秒（即 20 秒）</li><li>poolTimeToWait – 这是一个底层设置，如果获取连接花费的相当长的时间，它会给连接池打印状态日志并重新尝试获取一个连接（避免在误配置的情况下一直安静的失败），默认值：20000 毫秒（即 20 秒）。</li><li>poolPingQuery – 发送到数据库的侦测查询，用来检验连接是否处在正常工作秩序中并准备接受请求。默认是”NO PING QUERY SET”，这会导致多数数据库驱动失败时带有一个恰当的错误消息。</li><li>poolPingEnabled – 是否启用侦测查询。若开启，也必须使用一个可执行的 SQL 语句设置 poolPingQuery 属性（最好是一个非常快的 SQL），默认值：false。</li><li>poolPingConnectionsNotUsedFor – 配置 poolPingQuery 的使用频度。这可以被设置成匹配具体的数据库连接超时时间，来避免不必要的侦测，默认值：0（即所有连接每一时刻都被侦测 — 当然仅当 poolPingEnabled 为 true 时适用）。</li></ul><h3 id="8、数据库厂商标识（databaseIdProvider）"><a href="#8、数据库厂商标识（databaseIdProvider）" class="headerlink" title="8、数据库厂商标识（databaseIdProvider）"></a>8、数据库厂商标识（databaseIdProvider）</h3><p>可以让Mybatis通过不同的数据库厂商执行不同的语句，具体配置方法如下<br>1、在主配置文件中加入数据库厂商标识</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;Oracle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;oracle&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在上面的配置中有两个点比较关键<br>（1）databaseIdProvider标签的type属性的DB_VENDOR,这个是MyBatis中默认的别名，对应<code>org.apache.ibatis.mapping.VendorDatabaseIdProvider</code>类,这个类将会从数据源获取的连接中获取数据源对应数据库的产品名（connection.getMetaData().getDatabaseProductName()）设置成对应的databaseId,当然也可以实现<code>org.apache.ibatis.mapping.DatabaseIdProvider</code>类进行配置<br>（2）从上面获取的databaseId可能会很长，在后期的配置中可能会很麻烦于是就通过property设置属性别名来使其变短<br>2、在Mapper映射文件中配置不同的数据源对应的SQL语句</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTime&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line"> select  now() from dual</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTime&quot;</span>  <span class="attr">resultType</span>=<span class="string">&quot;string&quot;</span>&gt;</span></span><br><span class="line"> select  now() from dual</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTime&quot;</span>   <span class="attr">resultType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">databaseId</span>=<span class="string">&quot;oracle&quot;</span>&gt;</span></span><br><span class="line"> select  &#x27;oralce&#x27;||to_char(sysdate,&#x27;yyyy-mm-dd hh24:mi:ss&#x27;)  from dual</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>比如在使用getTime时，在environments的dataSource中获取的数据源时Mysql的情况下，MyBatis会加载databaseId为mysql的语句，oracle同理，如果没用进行配置的时候会加载没有配置databaseId的语句。<br>databaseIdProvider、databaseId以及environment的结合可以实现多数据库多厂商的配置。</p><h3 id="9、映射器（mappers）"><a href="#9、映射器（mappers）" class="headerlink" title="9、映射器（mappers）"></a>9、映射器（mappers）</h3><p>按照顺序配置好各项参数后，MyBatis的运行环境相关配置基本已经差不多了，现在就需要告诉MyBatis去哪边找到SQL语句，这个时候Mappers就相当于引路人可以通过提供相对于类路径的资源引用， 或完全限定资源定位符或类名和包名等告诉MyBatis去找各个映射然后从映射中取出对应的SQL语句。<br>所以有下面四种常见的方式来配置mappers。</p><figure class="highlight xml"><figcaption><span>1、使用映射文件的相对路径进行配置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/AuthorMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/BlogMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/PostMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><figcaption><span>2、使用接口全类名的方式进行配置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.mappers.UserMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.mappers.ProductMapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.mappers.ManagerMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><figcaption><span>3、使用包名进行配置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.mappers&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><figcaption><span>4、使用文件系统绝对路径进行配置</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/ProductMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///var/mappers/ManagerMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在日常使用中经常使用前3种方式进行配置，在配置中需要注意在配置标签中属性的名称，主要分url、resource、class、name：</p><ul><li>package中只有一个属性，就是包名name</li><li>mapper中使用url后面跟的就是全地址</li><li>mapper中使用resource的就是相对地址</li><li>mapper中使用class的就是对应的接口全类名</li></ul><p>在主配置有很多属性保持默认即可，有特殊需求时再做配置，需要重点关注的是setting和environments，这两个在Mybatis的生命周期中有着很重要的影响，如果配置不合理可能会影响整个框架的运行，结束了枯燥的主配置文件，下面就开始介绍一下SQL的载体Mapper配置文件。</p></div><div class="story post-story"><h2 id="三、MyBatis的Mapper映射文件"><a href="#三、MyBatis的Mapper映射文件" class="headerlink" title="三、MyBatis的Mapper映射文件"></a>三、MyBatis的Mapper映射文件</h2><p>相比于主配置文件，Mapper文件把更多的权力交给了开发者，用简单的功能实现强大的功能，他的顶层结构如下：</p><ul><li>cache –  给定命名空间的缓存配置。</li><li>cache-ref –  其他命名空间缓存配置的引用。</li><li>resultMap –  是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。</li><li>sql –  可被其他语句引用的可重用语句块。</li><li>insert –  映射插入语句</li><li>update –  映射更新语句</li><li>delete –  映射删除语句</li><li>select –  映射查询语句<br>在上面只是写了一个很简单的UserMapper.xml，在实际上使用中，一个Mapper文件大致长这个样子<figure class="highlight xml"><figcaption><span>UserMapper.xml</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 用户信息ResultMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据用户编号，查询单个用户实体 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">          SELECT * FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">     <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 新增用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">            INSERT INTO user(username,password,birthday)</span><br><span class="line">            VALUES(#&#123;username&#125;,#&#123;password&#125;,#&#123;birthday&#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 修改用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        UPDATE user SET username = #&#123;username&#125; ,password=#&#123;password&#125; ,birthday=#&#123;birthday&#125; WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 删除用户 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">            DELETE FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="1、insert、delete、update及select标签的属性"><a href="#1、insert、delete、update及select标签的属性" class="headerlink" title="1、insert、delete、update及select标签的属性"></a>1、insert、delete、update及select标签的属性</h3><p>上面代码中介绍了整个对用户的增删改查，分别使用insert、delete、update及select标签，下面就先来看一下标签中的属性：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">select</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;selectPerson&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterMap</span>=<span class="string">&quot;deprecated&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">resultType</span>=<span class="string">&quot;hashmap&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">resultMap</span>=<span class="string">&quot;personResultMap&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">fetchSize</span>=<span class="string">&quot;256&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">resultSetType</span>=<span class="string">&quot;FORWARD_ONLY&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;insertAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;domain.blog.Author&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyProperty</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">keyColumn</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;updateAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;domain.blog.Author&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span></span></span><br><span class="line"><span class="tag">  <span class="attr">id</span>=<span class="string">&quot;deleteAuthor&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">parameterType</span>=<span class="string">&quot;domain.blog.Author&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">statementType</span>=<span class="string">&quot;PREPARED&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">timeout</span>=<span class="string">&quot;20&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><table><thead><tr><th>属性名</th><th>对应含义</th></tr></thead><tbody><tr><td>id</td><td>SQL映射配置的唯一标识，可以代表SQL配置。</td></tr><tr><td>parameterType</td><td>可选属性，用来传入SQL配置中需要的参数类型的类名或别名。</td></tr><tr><td>resultType</td><td>从这条语句中返回的期望类型的类的完全限定名或别名。 注意如果返回的是集合，那应该设置为集合包含的类型，而不是集合本身。可以使用 resultType 或 resultMap，但不能同时使用。</td></tr><tr><td>resultMap</td><td>外部 resultMap 的命名引用。结果集的映射是 MyBatis 最强大的特性，如果你对其理解透彻，许多复杂映射的情形都能迎刃而解。可以使用 resultMap 或 resultType，但不能同时使用。</td></tr><tr><td>flushCache</td><td>设置语句调用时，是否清空本地缓存和二级缓存，默认为false。</td></tr><tr><td>useCache</td><td>设置语句调用时，执行结果是否保存二级缓存，对select元素默认为false。</td></tr><tr><td>timeout</td><td>这个设置是在抛出异常之前，驱动程序等待数据库返回请求结果的秒数。</td></tr><tr><td>fetchSize</td><td>设置驱动程序每次批量返回结果的行数。</td></tr><tr><td>statementType</td><td>设置MyBatis的statement类型。可以配置为STATEMENT，PREPARED 或 CALLABLE 中的一个，表示使用Statement，PreparedStatement 或 CallableStatement，默认值：PREPARED。</td></tr><tr><td>resultSetType</td><td>设置MyBatis的结果集类型。可以配置为FORWARD_ONLY，SCROLL_SENSITIVE, SCROLL_INSENSITIVE 或 DEFAULT（等价于 unset） 中的一个，默认值为 unset （依赖驱动）。</td></tr><tr><td>databaseId</td><td>在配置databaseIdProvider（数据库厂商标识）的情况下，MyBatis会加载所有不带databaseId或者匹配当前databaseId的语句。</td></tr><tr><td>resultOrdered</td><td>这个设置仅针对嵌套结果 select 语句适用：如果为 true，就是假设包含了嵌套结果集或是分组，这样的话当返回一个主结果行的时候，就不会发生有对前面结果集的引用的情况。 这就使得在获取嵌套的结果集的时候不至于导致内存不够用。默认值：false。</td></tr><tr><td>resultSets</td><td>当有多个结果集的时候使用，会为SQL执行后返回的每个结果集设定一个名称，以逗号分隔。</td></tr><tr><td>useGeneratedKeys</td><td>（仅对 insert 和 update 有用）这会令 MyBatis 使用 JDBC 的 getGeneratedKeys 方法来取出由数据库内部生成的主键（比如：像 MySQL 和 SQL Server 这样的关系数据库管理系统的自动递增字段），默认值：false。</td></tr><tr><td>keyProperty</td><td>（仅对 insert 和 update 有用）唯一标记一个属性，MyBatis 会通过 getGeneratedKeys 的返回值或者通过 insert 语句的 selectKey 子元素设置它的键值，默认值：未设置（unset）。如果希望得到多个生成的列，也可以是逗号分隔的属性名称列表。</td></tr><tr><td>keyColumn</td><td>（仅对 insert 和 update 有用）通过生成的键值设置表中的列名，这个设置仅在某些数据库（像 PostgreSQL）是必须的，当主键列不是表中的第一列的时候需要设置。如果希望使用多个生成的列，也可以设置为逗号分隔的属性名称列表。</td></tr></tbody></table><p>该表整理自<a href="https://mybatis.net.cn/sqlmap-xml.html">MyBatis的官网</a>，其中很多的词汇很生疏很难懂，在大部分日常中保持默认值即可，在特殊的时候需要去了解更多关于JDBC相关的知识，本文暂时不做论述，下面就是需要介绍一下在基础增删改查中出现的最重要的两个地方————Mapper配置输入映射和Mapper配置输出映射。</p><h3 id="2、Mapper配置输入映射"><a href="#2、Mapper配置输入映射" class="headerlink" title="2、Mapper配置输入映射"></a>2、Mapper配置输入映射</h3><p>在增删改查中，往往少不了参数的传递有许多SQL配置是需要传递参数的。在MyBatis的SQL映射配置文件Mapper.xml中，输入参数属性配置在parameterType中。对于parameterType属性，可以配置的基本数据类型有：int、double、float、short、long、byte、char、boolean，基本数据包装类有：Byte、Short、Integer、Long、Float、Double、Boolean、Character，还有Java复杂数据类型JavaBean（String）或其他自定义的实体类，同时也可以配为类对应<a href="/202205171260b55f.html#3-typeAliases%EF%BC%88%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D%EF%BC%89">类型别名</a>。</p><h3 id="3、Mapper配置输出映射"><a href="#3、Mapper配置输出映射" class="headerlink" title="3、Mapper配置输出映射"></a>3、Mapper配置输出映射</h3><p>在MyBatis的Mapper映射文件中，SQL语句查询后返回的结果，会映射到配置标签的输出映射属性对应的Java类型。Mapper的输出映射有两种配置，分别是resultType和resultMap。</p><h4 id="3-1、resultType"><a href="#3-1、resultType" class="headerlink" title="3.1、resultType"></a>3.1、resultType</h4><p>resultType除了像parameter一样支持基本数据类型、基本数据包装类之外，也支持自定义实体类。</p><div class="note warning"><p>如果从数据库查询出来的列名与实体类中的属性名全都不一致，则不会创建实体类对象，如果数据库查询出来的列名与实体类的属性名至少有一个一致，那么就会创建实体类对象。</p></div><h4 id="3-2、resultMap"><a href="#3-2、resultMap" class="headerlink" title="3.2、resultMap"></a>3.2、resultMap</h4><p>如果我们SQL查询出的内容和创建的实体类没有一个字段是相同的，但是又想把数据填充到对应的字段中，这个时候MyBatis提供了一种SQL结果集输出映射类型————resultMap，可以通过定义一个resultMap在列名和Java包装类属性名之间创建映射关系。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--定义一个resultMap--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.alex.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;birthday&quot;</span> <span class="attr">property</span>=<span class="string">&quot;birthday&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 使用resultMap调用id为userResultMap进行封装--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span><br><span class="line">     SELECT * FROM user WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用id为“userResultMap”的resultMap配置将select查询语句和User类中的属性进行映射。id属性是resultMap的唯一标识，而type是最终所映射的Java对象类型，可以使用别名。在resultMap标签对中，id标签指的是查询结果集中的唯一标识（比如User的唯一标识就是id），result标签指的是普通列的定义（User类中的其他非主键属性），其column指的是SQL语句查询出的列名，然后对应的property是type所指定的Java实体类中的属性名，最终resultMap会对column和property进行映射（对应关系），这样最终就会拿到一个填充了查询结果的User类。</p><div class="note warning"><p>如果resultMap在其他的Mapper配置文件中，则需要在id前面加上那个Mapper配置文件的namespace即可。</p></div></div><div class="story post-story"><h2 id="四、最终的CRUD"><a href="#四、最终的CRUD" class="headerlink" title="四、最终的CRUD"></a>四、最终的CRUD</h2><p>上面对MyBatis进行的基本的配置，简单配置之后就可以让MyBatis跑起来了，对于JAVA程序而言主要是分为四部<br>1、获取主配置文件的IO流<br>2、通过配置文件获取对应SqlSessionFactory<br>3、通过SqlSessionFactory获取一个SqlSession<br>4、通过SqlSession进行CRUD</p><figure class="highlight xml"><figcaption><span>对初体验的代码进行改进，加上增删改的方法</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws IOException &#123;</span><br><span class="line">    String resource = &quot;mybatis-config.xml&quot;;</span><br><span class="line">    //1、获取主配置文件的IO流</span><br><span class="line">    InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">    //2、通过配置文件获取对应SqlSessionFactory</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    //3、通过SqlSessionFactory获取一个SqlSession</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">    List<span class="tag">&lt;<span class="name">User</span>&gt;</span> list = sqlSession.selectList(&quot;User.findAll&quot;);</span><br><span class="line">    for (User user : list) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------&quot;);</span><br><span class="line">    User oneUser = sqlSession.selectOne(&quot;User.findUserById&quot;, 1);</span><br><span class="line">    System.out.println(oneUser);</span><br><span class="line">    System.out.println(&quot;---------------------&quot;);</span><br><span class="line">    User userInfo = new User();</span><br><span class="line">    userInfo.setUsername(&quot;lalala&quot;);</span><br><span class="line">    userInfo.setPassword(&quot;123456&quot;);</span><br><span class="line">    userInfo.setBirthday(&quot;2022-05-01&quot;);</span><br><span class="line">    sqlSession.insert(&quot;User.insertUser&quot;,userInfo);</span><br><span class="line">    list = sqlSession.selectList(&quot;User.findAll&quot;);</span><br><span class="line">    for (User user : list) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------&quot;);</span><br><span class="line">    oneUser.setUsername(&quot;657657&quot;);</span><br><span class="line">    sqlSession.update(&quot;User.updateUser&quot;,oneUser);</span><br><span class="line">    list = sqlSession.selectList(&quot;User.findAll&quot;);</span><br><span class="line">    for (User user : list) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;---------------------&quot;);</span><br><span class="line">    sqlSession.delete(&quot;User.deleteUser&quot;,2);</span><br><span class="line">    list = sqlSession.selectList(&quot;User.findAll&quot;);</span><br><span class="line">    for (User user : list) &#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="note warning"><p>这里一定要注意，因为是Demo的代码我写在main函数中，这边没有对数据进行提交的回滚以及对sqlSession资源的释放，如果真实使用请使用try catch包裹对事务进行提交以及资源释放</p></div><div galleryFlag itemscope itemtype="http://schema.org/ImageGallery" class="gallery " data-group='one'><div class='fancybox'><a class='fancybox' pjax-fancybox itemscope itemtype="http://schema.org/ImageObject" itemprop="url" href='https://bu.dusays.com/2022/05/19/628668ba78c22.png' data-fancybox='one' data-caption='运行结果'><img fancybox itemprop="contentUrl" src="https://bu.dusays.com/2022/05/19/628668ba78c22.png" class="lazyload" data-srcset="https://bu.dusays.com/2022/05/19/628668ba78c22.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="运行结果"></a><span class='image-caption'>运行结果</span></div></div><p>通过上面的例子可以看出sqlSession对于CRUD主要提供了五个方法，第一个参数都为statementId(Mapper文件的namespace+对应映射语句的id)，后面的跟对应的参数，这样好像相对于JDBC来说只是不用我们去写结果集和实体类的映射，但是与之带来的是更多的配置，其实不然，本文中目前仅仅只是介绍了MyBatis最基本的使用，通过上面的代码进行简单的配置，已经可以进行数据库的访问，MyBatis除了基础的数据库访问和结果集映射还有很多高级用法，具体又有哪些高阶用法请看XXXXXX。</p></div>]]></content>
      
      
      <categories>
          
          <category> 分类6 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 测试11 </tag>
            
            <tag> 测试10 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
